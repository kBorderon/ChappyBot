<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: commandes/Utilitaire/meteo.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: commandes/Utilitaire/meteo.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const { MessageEmbedÂ } = require('discord.js');
const fetch = require('node-fetch');
const { PREFIX, TOKEN_METEO_API } = require('../../configuration/config.js');

/**
 * Run de la commande meteo
 * @author KÃ©vin Borderon	
 * @module meteo/run
 * @description ATTENTION aux villes homonymes dans le mÃªme pays, aucune solution ne permet de distinguer ces 2 villes (par exemple Plouhinec Morbihan et Plouhinec FinistÃ¨re).
	Pour les villes homonymes dans 2 pays diffÃ©rents, il suffi d'indiquer ?meteo nom_ville, nom_pays comme par exemple ?meteo Vay, France et ?meteo Vay, Inde.
 * @param {Client} client - RÃ©fÃ©rence au bot
 * @param {Message} message - Le message reÃ§u par le bot
 * @param {Array.&lt;String>} categorie - Les arguments du message
 */
module.exports.run = (client, message, args) => {
	/* Conditions mÃ©tÃ©orologiques actuelle, demain et aprÃ¨s-demain */
	var conditionsMeteos = new Array(3);  /* L'api gratuite, nous limite Ã  3 jours */

	/* Contenus du message que nous envoyons */
	var description = '';
	var description2 = '';

	/* Direction du vent */	
	var directionVent = '';

	/* HumiditÃ© */
	var humidite = '';

	/* Indicateur journÃ©e : jour ou nuit */
	var indicateurJournee = '';

	/* Nom du pays */
	var nomPays = '';

	/* Nom de la rÃ©gion */
	var nomRegion = '';

	/* Nom de la ville */
	var nomVille = '';

	/* PrÃ©cipitation */
	var precipitation = '';

	/* ProbabilitÃ©s de prÃ©cipitations pour aujourd'hui, demain et aprÃ¨s-demain */
	var probabilitesPrecipitation = new Array(3); /* L'api gratuite, nous limite Ã  3 jours */
	
	/* TempÃ©ratures actuelle, pour demain et aprÃ¨s demain */
	var temperatures = new Array(3); /* L'api gratuite, nous limite Ã  3 jours */

	/* TempÃ©ratures minimums pour aujourd'hui, demain et aprÃ¨s-demain */
	var temperaturesMinimums = new Array(3); /* L'api gratuite, nous limite Ã  3 jours */

	/* TempÃ©ratures maximums pour aujourd'hui, demain et aprÃ¨s-demain */
	var temperaturesMaximums = new Array(3); /* L'api gratuite, nous limite Ã  3 jours */

	/* TempÃ©rature actuelle ressentie */
	var temperatureRessentie = '';

	/* TempÃ©rature actuelle ressentie */
	var temperatureRessentie = '';

	/* Ultraviolet */
	var uv = '';

	/* Force du vent en km/h */
	var vent = '';	
	
	/* Variables Ã©mojis */
		/* Emoji humiditÃ© */
		const humiditeEmoji = 'ðŸ’§';

		/* Emoji jour nuit */
		const jourNuitEmoji = 'ðŸŒ“';

		/* Emoji prÃ©cipitation */
		const precipitationEmoji = 'ðŸŒ§ï¸';		

		/* Emoji probabilitÃ© prÃ©cipitation personnalisÃ© */
		const probabilitePrecipitationEmoji = 'â˜”';
			
		/* Emoji statut journÃ©e */
		var statutJourneeEmoji = '';

		/* Emoji tempÃ©rature ressentie */
		const temperatureRessentieEmoji = 'ðŸŒž'; 

		/* Emoji thermometre personnalisÃ© */
		const thermometreEmoji = message.guild.emojis.cache.get('721101554534580224'); // Lire README.md dans le dossier contenu/emojis
 
		/* Emoji ultraviolet */
		const uvEmoji = message.guild.emojis.cache.get('721101554865668207'); // Lire README.md dans le dossier contenu/emojis

		/* Emoji vent */
		const ventEmoji = 'ðŸ’¨';
	
	/* RÃ©cupÃ©ration de la ville */
	for(let index = 0; index &lt; args.length; index++){
		nomVille += `${args[index]} `;
	}	

	fetch(`http://api.weatherapi.com/v1/forecast.json?key=${TOKEN_METEO_API}&amp;q=${nomVille}&amp;days=3&amp;lang=fr`).then(function(reponse){
		if(reponse.status !== 200){
			message.channel.send(`&lt;@${message.author.id}>, impossible d'obtenir la mÃ©tÃ©o pour cette ville, le nom **${nomVille}** n'est pas reconnu !`);	
		} else {
			reponse.json().then(donnees => { 
				/* Actualisation de la direction du vent par rapport au 16 points cardinaux */
				switch(donnees['current']['wind_dir']){
					case 'N': directionVent += 'du Nord';
						break;

					case 'NNE': directionVent += 'du Nord-Nord-Est';
						break;

					case 'NE': directionVent += 'du Nord-Est';
						break;
	
					case 'ENE': directionVent += 'de l\'Est-Nord-Est';
						break;
				
					case 'E': directionVent += 'de l\'Est';
						break;
				 
					case 'ESE': directionVent += 'de l\'Est-Sud-Est';
						break;

					case 'SE': directionVent += 'du Sud-Est';
						break;

					case 'SSE': directionVent += 'du Sud-Sud-Est';
						break;

					case 'S': directionVent += 'du Sud';
						break;
		
					case 'SSW': directionVent += 'du Sud-Sud-Ouest';
						break;	

					case 'SW': directionVent += 'du Sud-Ouest';
						break;	

					case 'WSW': directionVent += 'de l\'Ouest-Sud-Ouest';
						break;					

					case 'W': directionVent += 'de l\'Ouest';
						break;	

					case 'WNW': directionVent += 'de l\'Ouest-Nord-Ouest';
						break;	

					case 'NW': directionVent += 'du Nord-Ouest';
						break;	

					case 'NNW': directionVent += 'du Nord-Nord-Ouest';
						break;	

					default: directionVent += 'erreur'; // Ne passera jamais lÃ  mais on ne sait jamais !
				}

				/* Actualisation des conditions mÃ©tÃ©orologiques actuelle, demain et aprÃ¨s-demain */
				conditionsMeteos[0] = donnees['current']['condition']['text'];														/* Condition mÃ©tÃ©orologique actuelle */
				conditionsMeteos[1] = donnees['forecast']['forecastday'][1]['day']['condition']['text']; 	/* Condition mÃ©tÃ©orologique demain */
				conditionsMeteos[2] = donnees['forecast']['forecastday'][2]['day']['condition']['text']; 	/* Condition mÃ©tÃ©orologique aprÃ¨s-demain */	

				/* Actualisation de l'humiditÃ© */
				humidite += donnees['current']['humidity'] + '%';
	
				/* Actualisation de l'indicateur de journÃ©e */
				indicateurJournee += donnees['current']['is_day'] === 1 ? 'jour' : 'nuit';

				/* Actualisation du nom du pays */
				nomPays += donnees['location']['country'];

				/* Actualisation du nom de la rÃ©gion */
				nomRegion += donnees['location']['region'];
			
				/* Actualisation du nom de la ville (au cas oÃ¹ on prÃ©cise le pays dans la commande) */
				nomVille = donnees['location']['name'];

				/* Actualisation de la prÃ©cipitation */
				precipitation += donnees['current']['precip_in'] + ' mm';

				/* Actualisation des probabilitÃ©s de prÃ©cipitation pour aujourd'hui, demain et aprÃ¨s-demain */
				probabilitesPrecipitation[0] = donnees['forecast']['forecastday'][0]['day']['daily_chance_of_rain'] + '%';	/* ProbabilitÃ© de prÃ©cipitation pour aujourd'hui */
				probabilitesPrecipitation[1] = donnees['forecast']['forecastday'][1]['day']['daily_chance_of_rain'] + '%';	/* ProbabilitÃ© de prÃ©cipitation pour demain */
				probabilitesPrecipitation[2] = donnees['forecast']['forecastday'][2]['day']['daily_chance_of_rain'] + '%';	/* ProbabilitÃ© de prÃ©cipitation pour aprÃ¨s-demain */

				/* Actualisation de l'Ã©moji statut journÃ©e */
				statutJourneeEmoji = "jour" === indicateurJournee ? "ðŸŒ‡":"ðŸŒƒ";

				/* Actualisation de la tempÃ©rature actuelle, pour demain et aprÃ¨s-demain */
				temperatures[0] = donnees['current']['temp_c'] + "Â°C";
				temperatures[1] = donnees['forecast']['forecastday'][1]['day']['avgtemp_c'] + "Â°C";
				temperatures[2] = donnees['forecast']['forecastday'][2]['day']['avgtemp_c'] + "Â°C";		
		
				/* Actualisation de la tempÃ©rature minimum pour aujourd'hui, pour demain et aprÃ¨s-demain */
				temperaturesMinimums[0] = donnees['forecast']['forecastday'][0]['day']['mintemp_c'] + "Â°C";		/* TempÃ©rature minimum pour aujourd'hui */
				temperaturesMinimums[1] = donnees['forecast']['forecastday'][1]['day']['mintemp_c'] + "Â°C";		/* TempÃ©rature minimum pour demain */
				temperaturesMinimums[2] = donnees['forecast']['forecastday'][2]['day']['mintemp_c'] + "Â°C";		/* TempÃ©rature minimum pour aprÃ¨s-demain */

				/* Actualisation de la tempÃ©rature maximum pour aujourd'hui, pour demain et aprÃ¨s-demain */
				temperaturesMaximums[0] = donnees['forecast']['forecastday'][0]['day']['maxtemp_c'] + "Â°C"; 	/* TempÃ©rature maximum pour aujourd'hui */
				temperaturesMaximums[1] = donnees['forecast']['forecastday'][1]['day']['maxtemp_c'] + "Â°C";		/* TempÃ©rature maximum pour demain */
				temperaturesMaximums[2] = donnees['forecast']['forecastday'][2]['day']['maxtemp_c'] + "Â°C";		/* TempÃ©rature maximum pour aprÃ¨s-demain */

				/* Actualisation de la tempÃ©rature ressentie */
				temperatureRessentie += donnees['current']['feelslike_c'] + "Â°C";

				/* Actualisation de l'ultraviolet */
				uv += donnees['current']['uv'];

				/* Actualisation du vent */
				vent += donnees['current']['wind_kph'] + ` km/h en provenance ${directionVent}`;

				/* Actualisation des descriptions */
				description +=Â `**${nomVille}, ${nomRegion}, ${nomPays}**\nActuellement **${conditionsMeteos[0]}**, avec une tempÃ©rature de ${temperatures[0]}.`;
				description2 += `**Demain :** La condition mÃ©torologique sera **${conditionsMeteos[1]}**, avec une tempÃ©rature minimale de **${temperaturesMinimums[1]}**, maximale de **${temperaturesMaximums[1]}**. Il y aura une tempÃ©rature moyenne de **${temperatures[1]}** et **${probabilitesPrecipitation[1]} de probabilitÃ© de prÃ©cipitations**.\n`;
				description2 += `\n**AprÃ¨s-demain :** La condition mÃ©torologique sera **${conditionsMeteos[2]}**, avec une tempÃ©rature minimale de **${temperaturesMinimums[2]}**, maximale de **${temperaturesMaximums[2]}**. Il y aura une tempÃ©rature moyenne de **${temperatures[2]}** et **${probabilitesPrecipitation[2]} de probabilitÃ© de prÃ©cipitations**.`;
					
				const contenu = new MessageEmbed()
				.setColor("#4fd0ea")
				.setTitle(`MÃ©tÃ©o ${nomVille}, ${nomPays}`)
				.setURL("https://www.weatherapi.com/")
				.setTimestamp()
				.setDescription(description)
				.addFields(
					{ name: `${jourNuitEmoji} Statut journÃ©e`, value: `${statutJourneeEmoji} ${indicateurJournee}`, inline: true},
					{ name: `${thermometreEmoji} TempÃ©rature min`, value: `${temperaturesMinimums[0]}`, inline: true}, 
					{ name: `${thermometreEmoji} TempÃ©rature max`, value: `${temperaturesMaximums[0]}`, inline: true},
					{ name: `${temperatureRessentieEmoji} TempÃ©rature ressentie`, value: `${temperatureRessentie}`, inline: true},
					{ name: `${humiditeEmoji} HumiditÃ©`, value: `${humidite}`, inline: true},
					{ name: `${ventEmoji} Vent`, value: `${vent}`, inline: true},
					{ name: `${probabilitePrecipitationEmoji} ProbabilitÃ© de prÃ©cipitations`, value: `${probabilitesPrecipitation[0]}`, inline: true},
					{ name: `${uvEmoji} Ultraviolet`, value: `${uv}`, inline: true},
					{ name: `${precipitationEmoji} PrÃ©cipitation`, value: `${precipitation}`, inline: true},
					{Â name: `**__Informations pour les 2 journÃ©es Ã  venir__**`, value: `${description2}`}
				)
				.setFooter(`MÃ©tÃ©o pour la ville ${nomVille}`);

				/* On envoie le message prÃ©parÃ© */
				message.channel.send(contenu);
			});
		}
	});	
};

/**
 * Help de la commande meteo
 * @author KÃ©vin Borderon	
 * @module meteo/help
 * @description ATTENTION aux villes homonymes dans le mÃªme pays, aucune solution ne permet de distinguer ces 2 villes (par exemple Plouhinec Morbihan et Plouhinec FinistÃ¨re).
	Pour les villes homonymes dans 2 pays diffÃ©rents, il suffi d'indiquer ?meteo nom_ville, nom_pays comme par exemple ?meteo Vay, France et ?meteo Vay, Inde.
 * @param {Array.&lt;Meteo>} ['meteo', 'weather'] - Indique les aliases de la commande meteo
 * @param {boolean} args - Indique la prÃ©sence OBLIGATOIRE d'arguments, ici ils ne sont pas obligatoires donc false
 * @param {string} categorie - Indique la catÃ©gorie de la commande meteo
 * @param {number} cooldown - Indique le cooldown de la commande meteo avant sa prochaine utilisation de la part du mÃªme utilisateur
 * @param {string} description - Indique la description de la commande meteo
 * @param {string} nom - Indique le nom de la commande meteo
 * @param {string} utilisation - Indique l'utilisation de la commande meteo
 */
module.exports.help = {
	aliases:['meteo', 'weather'],	
	args: true,
	categorie: 'Utilitaire',
	cooldown: 30,
	description: 'Renvoie la mÃ©tÃ©o pour une ville prÃ©cise',
	nom: 'meteo',
	utilisation: "&lt;nom_ville> ou &lt;nom_ville>, &lt;nom_pays>"
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-blague_help.html">blague/help</a></li><li><a href="module-blague_run.html">blague/run</a></li><li><a href="module-cat_help.html">cat/help</a></li><li><a href="module-cat_run.html">cat/run</a></li><li><a href="module-dog_help.html">dog/help</a></li><li><a href="module-dog_run.html">dog/run</a></li><li><a href="module-feed_help.html">feed/help</a></li><li><a href="module-feed_run.html">feed/run</a></li><li><a href="module-help_help.html">help/help</a></li><li><a href="module-help_run.html">help/run</a></li><li><a href="module-membres_help.html">membres/help</a></li><li><a href="module-membres_run.html">membres/run</a></li><li><a href="module-meteo_help.html">meteo/help</a></li><li><a href="module-meteo_run.html">meteo/run</a></li><li><a href="module-ping_help.html">ping/help</a></li><li><a href="module-ping_run.html">ping/run</a></li><li><a href="module-projet_help.html">projet/help</a></li><li><a href="module-projet_run.html">projet/run</a></li><li><a href="module-rage_help.html">rage/help</a></li><li><a href="module-rage_run.html">rage/run</a></li><li><a href="module-roles_help.html">roles/help</a></li><li><a href="module-roles_run.html">roles/run</a></li><li><a href="module-sel_help.html">sel/help</a></li><li><a href="module-sel_run.html">sel/run</a></li><li><a href="module-userinfo_help.html">userinfo/help</a></li><li><a href="module-userinfo_run.html">userinfo/run</a></li><li><a href="module-userroles_help.html">userroles/help</a></li><li><a href="module-userroles_run.html">userroles/run</a></li></ul><h3>Classes</h3><ul><li><a href="Client.html">Client</a></li></ul><h3>Events</h3><ul><li><a href="Client.html#event:channelCreate">channelCreate</a></li><li><a href="Client.html#event:channelDelete">channelDelete</a></li><li><a href="Client.html#event:channelUpdate">channelUpdate</a></li><li><a href="Client.html#event:guildMemberAdd">guildMemberAdd</a></li><li><a href="Client.html#event:guildMemberRemove">guildMemberRemove</a></li><li><a href="Client.html#event:message">message</a></li><li><a href="Client.html#event:ready">ready</a></li></ul><h3>Global</h3><ul><li><a href="global.html#actualiserCompteur">actualiserCompteur</a></li><li><a href="global.html#chargerCommandes">chargerCommandes</a></li><li><a href="global.html#chargerEvenements">chargerEvenements</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Sun Jun 21 2020 20:11:46 GMT+0200 (heure dâ€™Ã©tÃ© dâ€™Europe centrale)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
